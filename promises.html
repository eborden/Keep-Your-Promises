<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Keep Your Promises</title>

		<meta name="description" content="Promises/A and jQuery.deferred">
		<meta name="author" content="Evan Rutledge Borden">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="revealjs/css/reveal.min.css">
		<link rel="stylesheet" href="revealjs/css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="revealjs/lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="revealjs/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="revealjs/lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Keep Your Promises</h1>
					<h3>and avoid nasty callbacks</h3>
					<p>
						<small>Created by <a href="http://www.evan-borden.com">Evan Borden</a> / <a href="http://twitter.com/evanborden">@evanborden</a></small>
					</p>
				</section>
                
				<section>
					<h2>We are going to discuss</h2>
                    <p>Promises and why they are...</p>
                    <ul>
                        <li>better than callbacks for async tasks</li>
                        <li>more modular</li>
                        <li>more testable</li>
                    </ul>
				</section>

				<section>
					<h2>Asynchronous</h2>
					<ul>
                        <li>Ajax</li>
                        <li>setTimeout</li>
                        <li>Web Workers</li>
                        <li>Animation</li>
					</ul>
                </section>

				<section>
                    <section>
                        <h2>Callback</h2>
                        <pre><code>
$.get('/my-url/', function (data) {
    //do stuff later
    alert(data);
});
                        </code></pre>
                    </section>
                    <section>
                        <h2>Continuation-passing Style</h2>
                        <p>Generalized functions with behavior supplied by the user</p>
                    </section>
				</section>

				<section>
                    <section>
                        <h2>Promise</h2>
                        <p>A declaration or assurance that one will do a particular thing...</p>
                    </section>
                    <section>
                        <h2>Promises/A</h2>
                        <p>A promise represents the eventual value returned from the single completion of an operation</p>
                        <small><a href="http://wiki.commonjs.org/wiki/Promises/A">Common JS Spec</a></small>
                    </section>
                    <section>
                        <h2>jQuery Promises</h2>
                        <pre><code>
$.get('/my-url/')
 .then(function (data) {
    //do stuff later
    alert(data);
 });
                        </code></pre>
                    </section>
                    <section>
                        <h2>Promise Are Values</h2>
                        <pre><code>
var promise = $.get('/my-url/');
promise.then(function (data) {
    //do stuff later
    alert(data);
});
                        </code></pre>
                        <aside class="notes">Callbacks affect values, promises return values to be affected.</aside>
                    </section>
                </section>

                <section>
                    <section>
                        <h2>Chaining Async</h2>
                    </section>
                    <section>
                        <h2>Continuation-Passing</h2>
                        <pre><code>
$.ajax({
    url: '/my-data/',
    type: 'get',
    success: function (data) {
        $.ajax({
            url: '/other-data/' + data,
            type: 'get',
            success: function (moreData) {
                console.log(moreData);
            }
        });
    }
})
                        </code></pre>
                    </section>
                    <section>
                        <h2>Gets Ugly Quick</h2>
                        <pre><code>
$.ajax({
    url: '/my-data/',
    type: 'get',
    success: function (data) {
        $.ajax({
            url: '/other-data/' + data,
            type: 'get',
            success: function (data) {
                $.ajax({
                    url: '/other-data/' + data,
                    type: 'get',
                    success: function (data) {
                        $.ajax({
                            url: '/other-data/' + data,
                            type: 'get',
                            success: function (data) {
                                console.log(data);
                            }
                        });
                    }
                });
            }
        });
    }
})
                        </code></pre>
                    </section>
                    <section>
                        <h2>Flatter and Fluent</h2>
                        <pre><code>
$.ajax({
    url: '/my-data/',
    type: 'get',
}).then(function (data) {
    return $.ajax({
        url: '/other-data/' + data,
        type: 'get'
    });
}).then(function (data) {
    return $.ajax({
        url: '/other-data/' + data,
        type: 'get'
    });
}).then(function (data) {
    return $.ajax({
        url: '/other-data/' + data,
        type: 'get'
    });
}).then(function (data) {
    console.log(data);
});
                        </code></pre>
                    </section>
                    <section>
                        <h2>Then</h2>
                        <p>promise.then() returns a promise.</p>
                        <pre><code>
var promise = $.ajax({
    url: '/my-data/',
    type: 'get',
});

var thenPromise = promise.then(function (data) {
    console.log(data);
});

promise == thenPromise;//false
                        </code></pre>
                    </section>
                    <section>
                        <h2>Return Values</h2>
                        <p>Then changes return behavior based on three circumstances:</p>
                        <p>The callback returns...
                        <ol>
                            <li>undefined</li>
                            <li>A promise object</li>
                            <li>Other values</li>
                        </ol>
                    </section>
                    <section>
                        <h2>Return a undefined</h2>
                        <pre><code>
$.ajax({
    url: '/my-data/',
    type: 'get',
}).then(function (data) {
    console.log(data);
}).then(function (sameData) {
    console.log(sameData); //same as before
});
                        </code></pre>
                    </section>
                    <section>
                        <h2>Return a promise</h2>
                        <pre><code>
$.ajax({
    url: '/my-data/',
    type: 'get',
}).then(function (data) {
    return $.ajax(
        url: '/other-data/' + data,
        type: 'get'
    });
}).then(function (otherData) {
    console.log(otherData);// result of other data
});
                        </code></pre>
                    </section>
                    <section>
                        <h2>Return a value</h2>
                        <pre><code>
$.ajax({
    url: '/my-data/',
    type: 'get',
}).then(function (data) {
    return 5;
}).then(function (value) {
    console.log(value);//5
});
                        </code></pre>
                    </section>
                    <section>
                        <h2>Zen of Then</h2>
                        <pre><code>
promise.then(done, fail, progress);

                        </code></pre>
                    </section>
                    <section>
                        <h2>Other Methods</h2>
                        <p>promise...</p>
                        <ul>
                            <li>.done()</li>
                            <li>.fail()</li>
                            <li>.progress()</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <h2>Is It Just Alternate Syntax?</h2>
                </section>
                <section>
                    <section>
                        <h2>Parallel and $.when()</h2>
                        <p>More new toys! Yay!</p>
                        <pre><code>
$.when(
    $.get('/my-data/'),
    $.get('/my-template/')
).then(function (data, template) {
    var html = render(template, data);
    $('body').html(html);
})
                        </code></pre>
                    </section>
                    <section>
                        <h2>$.when is hella meta</h2>
                        <p>A promise of a group of promises.</p>
                    </section>
                    <section>
                        <h3>This is possible via continuation-passing</h3>
                        <p>But you don't want to see it.</p>
                        <ul>
                            <li>It is ugly</li>
                            <li>Requires a lot of plumbing</li>
                            <li>Very one offy</li>
                            <li>It will end up looking like less elegant promises</li>
                        </ul>
                    </section>
                </section>
                <section>
                    <h1>Review</h1>
                    <ul>
                        <li class="fragment">Promises allow us to attatch callbacks to future data</li>
                        <li class="fragment">Promises can chain multiple functions and promises into one pipline</li>
                        <li class="fragment">then, done, fail and progress return different promises based on their callback's return value</li>
                        <li class="fragment">$.when allows us to parallelize promises into a single promise.</li>
                    </ul>
                </section>
                <section>
                    <h1>Here Be Dragons</h1>
                    <p>I'm about to get opinionated</p>
                </section>
                <section>
                    <h2>Promises are a superior Pattern</h2>
                    <ol>
                        <li>Respect seperation of concerns</li>
                        <li>Observe the DRY principal</li>
                        <li>Are functionaly composable</li>
                        <li>Are more testable</li>
                    </ol>
                </section>
                <section>
                    <section>
                        <h2>Seperation of Concerns</h2>
                        <p>Continuation-passing encourages tight coupling of:</p>
                        <ul>
                            <li>data</li>
                            <li>business logic</li>
                            <li>view logic</li>
                        </ul>
                        <pre><code>
$.ajax({
    url: "/foo/",
    success: function () {
        //transform data
        ...
        console.log(trasformed);
    }
});
                        </code></pre>
                    </section>
                    <section>
                        <p>Promises seperate these into units of computation</p>
                        <p>and binds them fluently</p>
                        <pre><code>
function promiseData () {
    return $.ajax(
        url: '/foo/'
    });
}
function transformData(data) {
    ...
}
function log (data) {
    console.log(data);
}
promiseData().then(transformData).then(log);
                        </code></pre>
                    </section>
                    <section>
                        <h2>This is DRY</h2>
                        <p>Do not Repeat Yourself</p>
                    </section>
                    <section>
                        <h2>DRY encourages modularity</h2>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Promises are composable</h2>
                    </section>
                    <section>
                        <h2>Promises Are Values</h2>
                        <ul>
                            <li class="fragment">Promises are functional style</li>
                            <li class="fragment">Functional style treats functions as values or data representations</li>
                            <li class="fragment">Functions that return promises are (in practice) pure functions</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Functional Purity</h2>
                        <ul>
                            <li class="fragment">Return a value</li>
                            <li class="fragment">Return the same value given the same input (idempotent)</li>
                            <li class="fragment">Cannot affect or be affected by outside values/state</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Impure Function</h2>
                        <pre class="fragment"><code>
function log (message) {
    console.log(message);
}
log('side effect');//undefined
                        </code></pre>
                        <pre class="fragment"><code>
var i = 0;
function crappyInc (digit) {
    return i = i + digit;
}
crappyInc(1);//1
crappyInc(1);//3
crappyInc(crappyInc(1));//6
console.log(i);//6
                        </code></pre>
                    </section>
                    <section>
                        <h2>Pure Function</h2>
                        <pre><code>
function inc (digit) {
    return digit + 1;
}
inc(2);//3
inc(2);//3
inc(2);//3
                        </code></pre>
                        <h2 class="fragment">Will it compose?</h2>
                        <pre class="fragment"><code>
inc(inc(1))//3
                        </code></pre>
                        <pre class="fragment"><code>
[1, 2, 3].map(inc)//[2, 3, 4]
                        </code></pre>
                    </section>
                    <section>
                        <h2>$.when and chaining</h2>
                        <p>Are forms of composition</p>
                        <p class="fragment">They  are not possible without return values</p>
                    </section>
                </section>
                <section>
                    <section>
                        <h2>Testing</h2>
                        <p>Put My Promises To The Test</p>
                    </section>
                    <section>
                        <h2>Testing Relies on Idempotence</h2>
                        <pre><code>
function promiseStuff (foo) {
    return $.get('/my-url/' + foo);
}
                        </code></pre>
                        <p class="fragment">You cannot trust dependencies</p>
                    </section>
                    <section>
                        <h2>Monkey Patching</h2>
                        <pre><code>
function promiseStuff (foo) {
    return $.get('/my-url/' + foo);
}
//Redeclare the function
function promiseStuff (test) {
    var values = {test: 1};
        d = $.Deferred();
    setTimeout(function () {
        d.resolve(values[foo]);
    }, 0)
    return d.promise();
}
                        </code></pre>
                    </section>
                    <section>
                        <h2>Mock Helper</h2>
                        <pre><code>
function mockPromise (return) {
    return function () {
        var d = $.Deferred();
        setTimeout(function () {
            d.resolve(return.apply(null, arguments));
        }, 0)
        return d.promise();
    }
}
promiseStuff = mockPromise(function (foo) {
    var values = {test: 1};
    return values[foo];
});
promiseStuff('test').then(log);//logs: 1
                        </code></pre>
                    </section>
                    <section>
                        <h2>Promises Encourage Modularity</h2>
                        <p>Unit testing is concerned with computation not retrieval</p>
                        <pre class="fragment"><code>
function promiseStuff (foo) {
    return $.get('/my-url/' + foo);
}
function transformData (data) {
    return data + 1;
}
promiseStuff().then(transformData).then(log);
                        </code></pre>
                        <p class="fragment">transformData is idempotent and therefore testable</p>
                    </section>
                </section>
                <section>
                    <h1>Review</h1>
                    <p>Promises...</p>
                    <ol>
                        <li>Respect seperation of concerns</li>
                        <li>Observe the DRY principal</li>
                        <li>Are functionaly composable</li>
                        <li>Are more testable</li>
                    </ol>
                </section>

                <section>
                    <h2>Pipe Values</h2>
                    <pre><code>
promisePipe = function () {
    var d = $.Deferred(),
        args = arguments;
    setTimeout(function () {
        d.resolve.apply(null, args);
    }, 0);
    return d.promise();
}
                    </code></pre>
                    <pre class="fragment"><code>
function inc (val) {
    return val + 1;
}
function log (val) {
    console.log(val);
}
promisePipe(7).then(inc).then(inc).then(log);
console.log(20);
                    </code></pre>
                </section>

                <section>
                    <h1>Any Negatives?</h1>
                </section>

                <section>
                    <h1>Questions?</h1>
                </section>

			</div>

		</div>

		<script src="revealjs/lib/js/head.min.js"></script>
		<script src="revealjs/js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'revealjs/lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'revealjs/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'revealjs/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'revealjs/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
